function checkVinNumber(e, t) {
    var a = $("#hdApiUrl").val(),
        s = ($("#hdIdlr").val(), "/api/Detail/CheckVinNumber?vinnumber=" + e + "&framenumber=" + t),
        i = toyotaDealerLog();
    $.ajax({
        type: "Get",
        url: a + s,
        headers: {
            Authorization: "X-XSRF-Token " + i,
            "X-XSRF-Token": i,
            "Content-Type": "application/json"
        },
        success: function(e) {
            if (console.log(e), null != e) {
                $(".waitingForSearch").css("display", "none"), $("#divErrorCarInfor").css("display", "none");
                var t = $(".vin_popup_" + e.id);
                if (null != t.length) {
                    var a = $(t).attr("id");
                    $.fancybox.open([{
                        src: "#" + a,
                        nav: !1
                    }])
                }
            } else $(".waitingForSearch").css("display", "none"), $("#divErrorCarInfor").css("display", "block")
        }
    })
}

function findGetParameter(e) {
    for (var t = null, a = [], s = location.search.substr(1).split("&"), i = 0; i < s.length; i++)(a = s[i].split("="))[0] === e && (t = decodeURIComponent(a[1]));
    return t
}

function GetAccessorybyCatId(e) {
    var t = $("#hdApiUrl").val(),
        a = "/api/Detail/GetAccessoriesNewCar?CatId=" + e + "&idDlr=" + $("#hdIdlr").val();
    $("#ulAccessoriesService").empty(), $("#tabsContentAccessoriesService").empty();
    var s = toyotaDealerLog();
    $.ajax({
        type: "Get",
        url: t + a,
        headers: {
            Authorization: "X-XSRF-Token " + s,
            "X-XSRF-Token": s,
            "Content-Type": "application/json"
        },
        success: function(e) {
            if (0 < e.length) {
                for (var t = "", a = "", s = "", i = $("#hdMoneyUnit").val(), o = (CheckIfIsMobileNotIpad(), 0); o < e.length; o++) {
                    s += '<li class="tab"><a href="#tab_accessories_service_0' + (o + 1) + '">' + e[o].name + "</a></li>", t += '<div id="tab_accessories_service_0' + (o + 1) + '" class="content-tab"><div class="inner"><ul class="list_item slide-mb">', a += '<div class="slide_pc_on_popup_operate popup_item" id="popup_pc_accessory_0' + o + '" style="display: none;"><div class="title_p">Phụ kiện chính hãng</div><div class="owl-carousel slide_pc_on_popup slide_pc_on_popup_tmv">';
                    for (var n = 0; n < e[o].lAcces.length; n++) {
                        var l = formatMoney(e[o].lAcces[n].aS_PRICE + ".000"),
                            c = subStringSmarter(e[o].lAcces[n].aS_TITLE, 50, " "),
                            r = e[o].lAcces[n].aS_DESC;
                        r = null != r && "" != r ? "<div class='txt_p_2'><strong>Mô tả:</strong><p>" + r + "</p></div>" : "";
                        var d = e[o].lAcces[n].aS_BENEFIT;
                        d = null != d && "" != d ? "<div class='txt_p_2'><strong>Lợi ích:</strong><p>" + d + "</p></div>" : "", t += '<li class="item item-accessory ' + (maxCount - 1 < n ? "behide" : "") + '" ' + (maxCount - 1 < n ? "style='display:none'" : "") + '><div class="inner_item"><p class="img"><a ' + ('class="open_popup_pc_pk" data-href="#popup_pc_accessory_0' + o + '" data-index="' + n + '"') + '><img class="lazy" src="/Content/images/notfound/notfound-images.png" data-original="/data/accessories/' + e[o].lAcces[n].id + "/" + e[o].lAcces[n].aS_IMG + '?w=257&h=127&mode=crop" alt=""></a></p><div class="txt"><div class="name"><span class="txt1"><a title="' + e[o].lAcces[n].aS_TITLE + '">' + c + '</a></span></div><p class="price">Giá từ: <span>' + l + "</span> <sup>" + i + "</sup></p></div></div></li>", a += '<div class="item"><div class="inner_item"><p class="img"><img src="/data/accessories/' + e[o].lAcces[n].id + "/" + e[o].lAcces[n].aS_IMG + '" alt="' + e[o].lAcces[n].aS_TITLE + '"></p><div class="txt_p"><div class="txt_p_1">' + e[o].lAcces[n].aS_TITLE + '</div><div class="txt_p_2">Giá: <strong>' + l + " <sup>" + i + "</sup></strong><br /></div>" + d + '<div class="txt_index">' + (n + 1) + " / " + e[o].lAcces.length + "</div></div></div></div>", 0
                    }
                    t += '</ul><a class="link-viewmore view-more-service view-more-accessory viewall" data-tabid="tab_accessories_service_0' + (o + 1) + '" isopen="false"><span>Xem thêm...</span></a></div></div></div>', a += "</div></div>"
                }
                $(s).appendTo("#ulAccessoriesService"), $(t).appendTo("#tabsContentAccessoriesService"), $("#listPopupAccessory").html(a), $(".slide-features").owlCarousel(owlOptionsOperate), $("img.lazy").lazyload({
                    effect: "fadeIn",
                    threshold: 200
                }), $("ul.tabs").tabs(), $(".various").fancybox({}), $(".view-more-accessory").on("click", function() {
                    var e = $(this).data("tabid");
                    "false" == $(this).attr("isopen") ? ($("#" + e + " .item-accessory.behide").css("display", "block"), $(this).attr("isopen", "true"), $(this).removeClass("viewall"), $(this).html("<span>Thu gọn</span>")) : ($("#" + e + " .item-accessory.behide").css("display", "none"), $(this).attr("isopen", "false"), $("html,body").animate({
                        scrollTop: $("#sec_dv_03").offset().top
                    }, "slow"), $(this).html("<span>Xem thêm...</span>"), $(this).addClass("viewall"))
                }), $("#ulAccessoriesService li.tab").on("click", function() {
                    $("img.lazy").lazyload({
                        threshold: 200
                    })
                }), OpenPopUpPK()
            } else $("#ulAccessoriesService").empty(), $("#tabsContentAccessoriesService").html("<p>Chưa có phụ kiện!</p>")
        }
    })
}

function OpenPopUpPK() {
    $(".open_popup_pc_pk").on("click", function() {
        var e = $(this).data("href"),
            t = $(this).data("index");
        $.fancybox.open([{
            src: e
        }]);
        var a = $($(this).data("href")).find(".owl-carousel");
        $(a).owlCarousel(owlOptionsPopUp), a.trigger("to.owl.carousel", t), a.on("changed.owl.carousel", function(e) {
            $(".owl-item").each(function() {
                var e, t = $(this).find("iframe");
                0 < t.length && (null != (e = t[0].contentWindow) && e.postMessage('{"event":"command","func":"pauseVideo","args":""}', "*"));
                0 < (e = $(this).find("video")).length && e.get(0).pause()
            });
            var t, a = $(e.target).find(".owl-item").eq(e.item.index).find("iframe");
            0 < a.length && (null != (t = a[0].contentWindow) && t.postMessage('{"event":"command","func":"playVideo","args":""}', "*"));
            0 < (t = $(e.target).find(".owl-item").eq(e.item.index).find("video")).length && t.get(0).play()
        }), setTimeout(function() {
            var e, t = $(a).find(".owl-item.active").find("iframe");
            0 < t.length && (null != (e = t[0].contentWindow) && e.postMessage('{"event":"command","func":"playVideo","args":""}', "*"));
            0 < (e = $(a).find(".owl-item.active").find("video")).length && e.get(0).play()
        }, 1e3)
    })
}

function GetAutoPart() {
    var e = $("#hdApiUrl").val(),
        t = $("#hdIdlr").val(),
        a = "/api/Detail/GetListAutoParts?_SeoUrl=" + $("#hdAutoPart").val() + "&idDlr=" + t;
    $("#ulListAutoPart").empty().addClass("auto_part");
    var s = toyotaDealerLog();
    $.ajax({
        type: "Get",
        url: e + a,
        headers: {
            Authorization: "X-XSRF-Token " + s,
            "X-XSRF-Token": s,
            "Content-Type": "application/json"
        },
        success: function(e) {
            if (0 < e.lNews.length) {
                for (var t = "", a = 0; a < e.lNews.length; a++) {
                    var s = "" == e.lNews[a].newS_URL ? e.lNews[a].newS_SEO_URL : e.lNews[a].newS_URL,
                        i = subStringSmarter(e.lNews[a].newS_TITLE, 40, " "),
                        o = subStringSmarter(e.lNews[a].newS_DESC, 150, " ");
                    t += '<li class="item item-autopart col l4 m4 s12 ' + (maxCount - 1 < a ? "behide" : "") + '" ' + (maxCount - 1 < a ? "style='display:none'" : "") + '><a class="various viewAutoPart" data-link="' + s + '" href="#popViewAutoPart00' + (a + 1) + '"><div class="inner"><p class="img"><img class="lazy" src="/Content/images/notfound/notfound-images.png" data-original="/data/news/' + e.lNews[a].id + "/" + e.lNews[a].newS_IMAGE3 + '?w=280&h=158&mode=crop" alt="' + e.lNews[a].newS_TITLE + '"></p><div class="txt"><h3 class="title" title="' + e.lNews[a].newS_TITLE + '">' + i + '</h3><div class="desc">' + o + "</div></div></div></a></li>", t += '<div data-isloaded="false" id="popViewAutoPart00' + (a + 1) + '" style="display:none" class="popup_item popup_auto_part"><div class="title_p">Phụ tùng chính hãng</div><div class="inner_p"><img src="/Content/images/gray75_polling.gif" style="margin: auto auto;display: block;top: 30%;position: absolute;left: 45%;"></div></div>'
                }
                $(t).appendTo("#ulListAutoPart"), $("img.lazy").lazyload({
                    effect: "fadeIn",
                    threshold: 200
                }), $(".various").fancybox({}), $(".viewAutoPart").on("click", function() {
                    var e = $(this).attr("href").replace(/#/g, ""),
                        t = $("#" + e).data("isloaded");
                    null != t && 0 == t && loadContentAutoPartDetail($(this).data("link"), e)
                }), $(".view-more-autopart").on("click", function() {
                    "false" == $(this).attr("isopen") ? ($(".item-autopart.behide").css("display", "block"), $(this).attr("isopen", "true"), $(this).removeClass("viewall"), $(this).html("<span>Thu gọn</span>")) : ($(".item-autopart.behide").css("display", "none"), $(this).attr("isopen", "false"), $(this).addClass("viewall"), $("html,body").animate({
                        scrollTop: $("#sec_dv_03").offset().top
                    }, "slow"), $(this).html("<span>Xem thêm...<span>"), $(this).addClass("viewall"))
                })
            } else $("#ulListAutoPart").html("<p>Chưa có phụ tùng!</p>")
        }
    })
}

function loadContentAutoPartDetail(e, n) {
    var t = $("#hdApiUrl").val(),
        a = "/api/Detail/GetNewDetail?_SeoUrl=" + e + "&idDlr=" + $("#hdIdlr").val(),
        s = toyotaDealerLog();
    $.ajax({
        type: "Get",
        url: t + a,
        headers: {
            Authorization: "X-XSRF-Token " + s,
            "X-XSRF-Token": s,
            "Content-Type": "application/json"
        },
        success: function(e) {
            var t = $("#" + n).find(".inner_p"),
                a = "";
            if (a += "<h3 class='tt-h3'><span>" + e.sTitle + "</span></h3>", 0 < e.lContent.length) {
                $("#hdMoneyUnit").val();
                a += '<div class="col s12"><div class="box_tabs"><ul class="tabs">';
                for (var s = 0; s < e.lContent.length; s++) a += '<li class="tab"><a href="#tab_' + n + s + '">' + e.lContent[s].contenT_TITLE + "</a></li>";
                a += "</ul></div></div>";
                for (var i = 0; i < e.lContent.length; i++) {
                    var o = "data/news/" + e.lContent[i].newS_ID + "/cont_" + e.lContent[i].contenT_TYPE + "/" + e.lContent[i].contenT_HTML;
                    a += '<div id="tab_' + n + i + '" class="content-tab iframe_content" data-content="inner_content_tab_' + n + i + '" data-iframe="' + o + '"><div class="inner" id="inner_content_tab_' + n + i + '">', a += "</div></div>"
                }
                $(t).html(a), $(".iframe_content").each(function() {
                    var e = $(this).data("iframe");
                    $("#" + $(this).data("content")).load(e), $(this).removeAttr("data-content").removeAttr("data-iframe")
                }), $("ul.tabs").tabs()
            } else $(t).html("<p>Chưa có nội dung!</p>");
            $("#" + n).data("isloaded", !0)
        }
    })
}

function getCatsModelDropDown() {
    var e = $("#hdApiUrl").val(),
        t = "/api/Estimates/LoadModelsCar?idDlr=" + $("#hdIdlr").val(),
        a = toyotaDealerLog();
    $.ajax({
        type: "Get",
        url: e + t,
        headers: {
            Authorization: "X-XSRF-Token " + a,
            "X-XSRF-Token": a,
            "Content-Type": "application/json"
        },
        success: function(e) {
            for (var t = '<option value="" disabled selected>Chọn mẫu xe</option>', a = 0; a < e.length; a++) t += '<option value="' + e[a].id + '">' + e[a].caT_NAME + "</option>";
            $(t).appendTo("#ddlCateCarService"), $("#ddlCateCarService").material_select(), $("#ddlCateCarService").on("change", function() {
                GetAccessorybyCatId($(this).val())
            })
        }
    })
}
var ismobile = CheckIfIsMobileNotIpad(),
    maxCount = ismobile ? 4 : 6;
$(document).ready(function() {
    var t = findGetParameter("section"),
        a = 0;
    setTimeout(function() {
        switch (t) {
            case "bao-hanh":
                a = $("#sec_dv_01").offset().top, $("html,body").animate({
                    scrollTop: a - 10
                }, "2000");
                break;
            case "bao-duong":
                a = $("#sec_dv_02").offset().top, $("html,body").animate({
                    scrollTop: a - 100
                }, "2000");
                break;
            case "phu-tung-phu-kien":
                a = $("#sec_dv_03").offset().top, $("html,body").animate({
                    scrollTop: a - 100
                }, "2000");
                var e = findGetParameter("tabs");
                null == e || "" == e ? $("ul.tabs").tabs("select_tab", "tab_pt_01") : "phu-kien" == e && $("ul.tabs").tabs("select_tab", "tab_pt_02");
                break;
            case "dich-vu-sua-chua":
                a = $("#sec_dv_04").offset().top, $("html,body").animate({
                    scrollTop: a - 100
                }, "2000");
                break;
            case "kiem-tra-trieu-hoi":
                a = $("#sec_dv_05").offset().top, $("html,body").animate({
                    scrollTop: a - 100
                }, "2000");
                break;
            case "dich-vu-khac":
                a = $("#sec_dv_06").offset().top, $("html,body").animate({
                    scrollTop: a - 100
                }, "2000")
        }
    }, 1500), getCatsModelDropDown(), GetAccessorybyCatId(0), GetAutoPart(), $("#btnSearchCarInfo").on("click", function() {
        var e = $("#txtVinNum").val(),
            t = $("#txtCarSerial").val();
        "" == $("#txtVinNum").val() && "" == $("#txtCarSerial").val() ? showErrorbyAlert("Sửa chữa đặc biệt", "Vui lòng nhập số Vin hoặc số khung!", "") : ($(".waitingForSearch").css("display", "block"), $("#divResultCarInfor").css("display", "none"), $("#divErrorCarInfor").css("display", "none"), checkVinNumber(e, t))
    })
});
var owlOptionsPopUp = {
    loop: !0,
    items: 1,
    margin: 6,
    nav: !0,
    dots: !0,
    lazyLoad: !0,
    animateIn: "fadeIn",
    animateOut: "fadeOut"
};
